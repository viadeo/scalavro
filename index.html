<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Scalavro by GenslerAppsPod</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Scalavro</h1>
        <p class="header">A runtime reflection-based Avro library in Scala.</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/GenslerAppsPod/scalavro/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/GenslerAppsPod/scalavro/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/GenslerAppsPod/scalavro">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/GenslerAppsPod">GenslerAppsPod</a></p>
      </header>
      <section>
<h1>
<a name="scalavro" class="anchor" href="#scalavro"><span class="octicon octicon-link"></span></a>Scalavro</h1>

<p>A runtime reflection-based Avro library in Scala.</p>

<p>A full description of Avro is outside the scope of this documentation, but here is an introduction from <a href="http://avro.apache.org/docs/current">avro.apache.org</a>:</p>

<blockquote>
<p><strong><a href="http://avro.apache.org">Apache Avro ™</a></strong> is a data serialization system.</p>

<p>Avro provides:</p>

<ul>
<li>Rich data structures.</li>
<li>A compact, fast, binary data format.</li>
<li>A container file, to store persistent data.</li>
<li>Remote procedure call (RPC).</li>
<li>Simple integration with dynamic languages. Code generation is not required to read or write data files nor to use or implement RPC protocols. Code generation as an optional optimization, only worth implementing for statically typed languages.</li>
</ul>
<p>Avro provides functionality similar to systems such as <strong><a href="http://thrift.apache.org">Thrift</a></strong>, <strong><a href="http://code.google.com/p/protobuf/">Protocol Buffers</a></strong>, etc.</p>
</blockquote>

<p>Scalavro takes a code-first, reflection based approach to schema generation and (de)serialization.  This yields a very low-overhead interface, and imposes some costs.  In general, Scalavro assumes you know what types you're reading and writing.  No built-in support is provided (as yet) for so-called schema resolution (taking the writer's schema into account when reading data).</p>

<h2>
<a name="goals" class="anchor" href="#goals"><span class="octicon octicon-link"></span></a>Goals</h2>

<ol>
<li>To provide an in-memory representation of avro schemas and protocols.</li>
<li>To synthesize avro schemas and protocols dynamically for a useful subset of Scala types.</li>
<li>To dynamically generate Scala bindings for reading and writing Avro-mapped Scala types to and from Avro binary.</li>
<li>Generally, to minimize fuss required to create an Avro-capable Scala application.</li>
</ol><h2>
<a name="obtaining-scalavro" class="anchor" href="#obtaining-scalavro"><span class="octicon octicon-link"></span></a>Obtaining Scalavro</h2>

<p>The <code>Scalavro</code> artifacts are available from Maven Central. The current release is <code>0.4.0</code>, built against Scala 2.10.2.</p>

<p>Using SBT:</p>

<div class="highlight highlight-scala"><pre><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"com.gensler"</span> <span class="o">%%</span> <span class="s">"scalavro"</span> <span class="o">%</span> <span class="s">"0.4.0"</span>
</pre></div>

<h2>
<a name="api-documentation" class="anchor" href="#api-documentation"><span class="octicon octicon-link"></span></a>API Documentation</h2>

<ul>
<li>Generated <a href="http://genslerappspod.github.io/scalavro/api/0.4.0/index.html#com.gensler.scalavro.package">Scaladoc for version 0.4.0</a>
</li>
</ul><h2>
<a name="index-of-examples" class="anchor" href="#index-of-examples"><span class="octicon octicon-link"></span></a>Index of Examples</h2>

<ul>
<li><a href="#arrays">Arrays</a></li>
<li><a href="#maps">Maps</a></li>
<li><a href="#enums">Enums</a></li>
<li><a href="#unions">Unions</a></li>
<li><a href="#fixed">Fixed-Length Data</a></li>
<li><a href="#records">Records</a></li>
<li><a href="#binary-io">Binary IO</a></li>
</ul><h2>
<a name="type-mapping-strategy" class="anchor" href="#type-mapping-strategy"><span class="octicon octicon-link"></span></a>Type Mapping Strategy</h2>

<h3>
<a name="primitive-types" class="anchor" href="#primitive-types"><span class="octicon octicon-link"></span></a>Primitive Types</h3>

<table>
<thead><tr>
<th>Scala Type</th>
      <th>Avro Type</th>
    </tr></thead>
<tbody>
<tr>
<td><code>
        Unit
      </code></td>
      <td><code>
        null
      </code></td>
    </tr>
<tr>
<td><code>
        Boolean        
      </code></td>
      <td><code>
        boolean
      </code></td>
    </tr>
<tr>
<td><code>
        Byte
      </code></td>
      <td><code>
        int
      </code></td>
    </tr>
<tr>
<td><code>
        Char
      </code></td>
      <td><code>
        int
      </code></td>
    </tr>
<tr>
<td><code>
        Short
      </code></td>
      <td><code>
        int
      </code></td>
    </tr>
<tr>
<td><code>
        Int
      </code></td>
      <td><code>
        int
      </code></td>
    </tr>
<tr>
<td><code>
        Long
      </code></td>
      <td><code>
        long
      </code></td>
    </tr>
<tr>
<td><code>
        Float
      </code></td>
      <td><code>
        float
      </code></td>
    </tr>
<tr>
<td><code>
        Double
      </code></td>
      <td><code>
        double
      </code></td>
    </tr>
<tr>
<td><code>
        String
      </code></td>
      <td><code>
        string
      </code></td>
    </tr>
<tr>
<td><code>
        scala.collection.Seq[Byte]
      </code></td>
      <td><code>
        bytes
      </code></td>
    </tr>
</tbody>
</table><h3>
<a name="complex-types" class="anchor" href="#complex-types"><span class="octicon octicon-link"></span></a>Complex Types</h3>

<table>
<thead><tr>
<th>Scala Type</th>
      <th>Avro Type</th>
    </tr></thead>
<tbody>
<tr>
<td><code>
        scala.collection.Seq[T]
      </code></td>
      <td><code>
        array
      </code></td>
    </tr>
<tr>
<td><code>
        scala.collection.Set[T]
      </code></td>
      <td><code>
        array
      </code></td>
    </tr>
<tr>
<td><code>
        scala.collection.Map[String, T]
      </code></td>
      <td><code>
        map
      </code></td>
    </tr>
<tr>
<td><code>
        scala.Enumeration#Value
      </code></td>
      <td><code>
        enum
      </code></td>
    </tr>
<tr>
<td>
        <code>enum</code> (Java)</td>
      <td><code>
        enum
      </code></td>
    </tr>
<tr>
<td><code>
        scala.util.Either[A, B]
      </code></td>
      <td><code>
        union
      </code></td>
    </tr>
<tr>
<td><code>
        scala.util.Option[T]
      </code></td>
      <td><code>
        union
      </code></td>
    </tr>
<tr>
<td><code>
        com.gensler.scalavro.util.Union[U]
      </code></td>
      <td><code>
        union
      </code></td>
    </tr>
<tr>
<td><code>
        com.gensler.scalavro.util.FixedData
      </code></td>
      <td><code>
        fixed
      </code></td>
    </tr>
<tr>
<td><em>
        Supertypes of non-recursive case classes without type parameters
      </em></td>
      <td><code>
        union
      </code></td>
    </tr>
<tr>
<td><em>
        Non-recursive case classes without type parameters
      </em></td>
      <td><code>
        record
      </code></td>
    </tr>
</tbody>
</table><h2>
<a name="general-information" class="anchor" href="#general-information"><span class="octicon octicon-link"></span></a>General Information</h2>

<ul>
<li>Built against Scala 2.10.2 with SBT 0.12.4</li>
<li>Depends upon <a href="https://github.com/spray/spray-json">spray-json</a>
</li>
<li>The <code>io</code> sub-project depends upon the Apache Java implementation of Avro (Version 1.7.4)</li>
</ul><h2>
<a name="current-capabilities" class="anchor" href="#current-capabilities"><span class="octicon octicon-link"></span></a>Current Capabilities</h2>

<ul>
<li>Dynamic Avro schema generation from vanilla Scala types</li>
<li>Avro protocol definitions and schema generation</li>
<li>Convenient, dynamic binary IO</li>
<li>Avro RPC protocol representation and schema generation</li>
<li>Schema conversion to "Parsing Canonical Form" (useful for Avro RPC protocol applications)</li>
</ul><h2>
<a name="current-limitations" class="anchor" href="#current-limitations"><span class="octicon octicon-link"></span></a>Current Limitations</h2>

<ul>
<li>JSON IO is not yet implemented</li>
<li>Schema resolution (taking the writer's schema into account when reading) is not yet implemented</li>
<li>Recursive type dependencies are detected but not handled optimally -- potentially valid types are rejected at runtime.  For example, the current version cannot synthesize an Avro schema for a simple recursively defined linked list node.  Supporting this is a planned enhancement.</li>
</ul><h2>
<a name="scalavro-by-example-schema-generation" class="anchor" href="#scalavro-by-example-schema-generation"><span class="octicon octicon-link"></span></a>Scalavro by Example: Schema Generation</h2>

<p><a name="arrays"></a></p>

<h3>
<a name="arrays" class="anchor" href="#arrays"><span class="octicon octicon-link"></span></a>Arrays</h3>

<h4>
<a name="scalaseq" class="anchor" href="#scalaseq"><span class="octicon octicon-link"></span></a>scala.Seq</h4>

<div class="highlight highlight-scala"><pre><span class="k">import</span> <span class="nn">com.gensler.scalavro.types.AvroType</span>
<span class="nc">AvroType</span><span class="o">[</span><span class="kt">Seq</span><span class="o">[</span><span class="kt">String</span><span class="o">]].</span><span class="n">schema</span>
</pre></div>

<p>Which yields:</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"type"</span> <span class="p">:</span> <span class="s2">"array"</span><span class="p">,</span>
  <span class="nt">"items"</span> <span class="p">:</span> <span class="s2">"string"</span>
<span class="p">}</span>
</pre></div>

<h4>
<a name="scalaset" class="anchor" href="#scalaset"><span class="octicon octicon-link"></span></a>scala.Set</h4>

<div class="highlight highlight-scala"><pre><span class="k">import</span> <span class="nn">com.gensler.scalavro.types.AvroType</span>
<span class="nc">AvroType</span><span class="o">[</span><span class="kt">Set</span><span class="o">[</span><span class="kt">String</span><span class="o">]].</span><span class="n">schema</span>
</pre></div>

<p>Which yields:</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"type"</span> <span class="p">:</span> <span class="s2">"array"</span><span class="p">,</span>
  <span class="nt">"items"</span> <span class="p">:</span> <span class="s2">"string"</span>
<span class="p">}</span>
</pre></div>

<p><a name="maps"></a></p>

<h3>
<a name="maps" class="anchor" href="#maps"><span class="octicon octicon-link"></span></a>Maps</h3>

<div class="highlight highlight-scala"><pre><span class="k">import</span> <span class="nn">com.gensler.scalavro.types.AvroType</span>
<span class="nc">AvroType</span><span class="o">[</span><span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Double</span><span class="o">]].</span><span class="n">schema</span>
</pre></div>

<p>Which yields:</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"type"</span> <span class="p">:</span> <span class="s2">"map"</span><span class="p">,</span>
  <span class="nt">"values"</span> <span class="p">:</span> <span class="s2">"double"</span>
<span class="p">}</span>
</pre></div>

<p><a name="enums"></a></p>

<h3>
<a name="enums" class="anchor" href="#enums"><span class="octicon octicon-link"></span></a>Enums</h3>

<h4>
<a name="scalaenumeration" class="anchor" href="#scalaenumeration"><span class="octicon octicon-link"></span></a>scala.Enumeration</h4>

<div class="highlight highlight-scala"><pre><span class="k">package</span> <span class="nn">com.gensler.scalavro.tests</span>
<span class="k">import</span> <span class="nn">com.gensler.scalavro.types.AvroType</span>

<span class="k">object</span> <span class="nc">CardinalDirection</span> <span class="k">extends</span> <span class="nc">Enumeration</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">CardinalDirection</span> <span class="o">=</span> <span class="nc">Value</span>
  <span class="k">val</span> <span class="n">N</span><span class="o">,</span> <span class="nc">NE</span><span class="o">,</span> <span class="n">E</span><span class="o">,</span> <span class="nc">SE</span><span class="o">,</span> <span class="n">S</span><span class="o">,</span> <span class="nc">SW</span><span class="o">,</span> <span class="n">W</span><span class="o">,</span> <span class="nc">NW</span> <span class="k">=</span> <span class="nc">Value</span>
<span class="o">}</span>

<span class="k">import</span> <span class="nn">CardinalDirection._</span>
<span class="nc">AvroType</span><span class="o">[</span><span class="kt">CardinalDirection</span><span class="o">].</span><span class="n">schema</span>
</pre></div>

<p>Which yields:</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"name"</span> <span class="p">:</span> <span class="s2">"CardinalDirection"</span><span class="p">,</span>
  <span class="nt">"type"</span> <span class="p">:</span> <span class="s2">"enum"</span><span class="p">,</span>
  <span class="nt">"symbols"</span> <span class="p">:</span> <span class="p">[</span><span class="s2">"N"</span><span class="p">,</span><span class="s2">"NE"</span><span class="p">,</span><span class="s2">"E"</span><span class="p">,</span><span class="s2">"SE"</span><span class="p">,</span><span class="s2">"S"</span><span class="p">,</span><span class="s2">"SW"</span><span class="p">,</span><span class="s2">"W"</span><span class="p">,</span><span class="s2">"NW"</span><span class="p">],</span>
  <span class="nt">"namespace"</span> <span class="p">:</span> <span class="s2">"com.gensler.scalavro.tests.CardinalDirection"</span>
<span class="p">}</span>
</pre></div>

<h4>
<a name="java-enum" class="anchor" href="#java-enum"><span class="octicon octicon-link"></span></a>Java <code>enum</code>
</h4>

<p>Definition (Java):</p>

<div class="highlight highlight-java"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">gensler</span><span class="o">.</span><span class="na">scalavro</span><span class="o">.</span><span class="na">tests</span><span class="o">;</span>
<span class="kd">enum</span> <span class="n">JCardinalDirection</span> <span class="o">{</span> <span class="n">N</span><span class="o">,</span> <span class="n">NE</span><span class="o">,</span> <span class="n">E</span><span class="o">,</span> <span class="n">SE</span><span class="o">,</span> <span class="n">S</span><span class="o">,</span> <span class="n">SW</span><span class="o">,</span> <span class="n">W</span><span class="o">,</span> <span class="n">NW</span> <span class="o">};</span>
</pre></div>

<p>Use (Scala):</p>

<div class="highlight highlight-scala"><pre><span class="k">import</span> <span class="nn">com.gensler.scalavro.types.AvroType</span>
<span class="k">import</span> <span class="nn">com.gensler.scalavro.tests.JCardinalDirection</span>

<span class="nc">AvroType</span><span class="o">[</span><span class="kt">JCardinalDirection</span><span class="o">].</span><span class="n">schema</span>
</pre></div>

<p>Which yields:</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"name"</span> <span class="p">:</span> <span class="s2">"JCardinalDirection"</span><span class="p">,</span>
  <span class="nt">"type"</span> <span class="p">:</span> <span class="s2">"enum"</span><span class="p">,</span>
  <span class="nt">"symbols"</span> <span class="p">:</span> <span class="p">[</span><span class="s2">"N"</span><span class="p">,</span><span class="s2">"NE"</span><span class="p">,</span><span class="s2">"E"</span><span class="p">,</span><span class="s2">"SE"</span><span class="p">,</span><span class="s2">"S"</span><span class="p">,</span><span class="s2">"SW"</span><span class="p">,</span><span class="s2">"W"</span><span class="p">,</span><span class="s2">"NW"</span><span class="p">],</span>
  <span class="nt">"namespace"</span> <span class="p">:</span> <span class="s2">"com.gensler.scalavro.tests"</span>
<span class="p">}</span>
</pre></div>

<p><a name="unions"></a></p>

<h3>
<a name="unions" class="anchor" href="#unions"><span class="octicon octicon-link"></span></a>Unions</h3>

<h4>
<a name="scalaeither" class="anchor" href="#scalaeither"><span class="octicon octicon-link"></span></a>scala.Either</h4>

<div class="highlight highlight-scala"><pre><span class="k">package</span> <span class="nn">com.gensler.scalavro.tests</span>
<span class="k">import</span> <span class="nn">com.gensler.scalavro.types.AvroType</span>

<span class="nc">AvroType</span><span class="o">[</span><span class="kt">Either</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">Boolean</span><span class="o">]].</span><span class="n">schema</span>
</pre></div>

<p>Which yields:</p>

<div class="highlight highlight-json"><pre><span class="p">[</span><span class="s2">"int"</span><span class="p">,</span> <span class="s2">"boolean"</span><span class="p">]</span>
</pre></div>

<p>and</p>

<div class="highlight highlight-scala"><pre><span class="nc">AvroType</span><span class="o">[</span><span class="kt">Either</span><span class="o">[</span><span class="kt">Seq</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>, <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Seq</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]]].</span><span class="n">schema</span>
</pre></div>

<p>Which yields:</p>

<div class="highlight highlight-json"><pre><span class="p">[{</span>
  <span class="nt">"type"</span> <span class="p">:</span> <span class="s2">"array"</span><span class="p">,</span>
  <span class="nt">"items"</span> <span class="p">:</span> <span class="s2">"double"</span>
<span class="p">},</span>
<span class="p">{</span>
  <span class="nt">"type"</span> <span class="p">:</span> <span class="s2">"map"</span><span class="p">,</span>
  <span class="nt">"values"</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">"type"</span> <span class="p">:</span> <span class="s2">"array"</span><span class="p">,</span>
    <span class="nt">"items"</span> <span class="p">:</span> <span class="s2">"int"</span>
  <span class="p">}</span>
<span class="p">}]</span>
</pre></div>

<h4>
<a name="scalaoption" class="anchor" href="#scalaoption"><span class="octicon octicon-link"></span></a>scala.Option</h4>

<div class="highlight highlight-scala"><pre><span class="k">package</span> <span class="nn">com.gensler.scalavro.tests</span>
<span class="k">import</span> <span class="nn">com.gensler.scalavro.types.AvroType</span>

<span class="nc">AvroType</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]].</span><span class="n">schema</span>
</pre></div>

<p>Which yields:</p>

<div class="highlight highlight-json"><pre><span class="p">[</span><span class="s2">"null"</span><span class="p">,</span> <span class="s2">"string"</span><span class="p">]</span>
</pre></div>

<h4>
<a name="comgenslerscalavroutilunionunion" class="anchor" href="#comgenslerscalavroutilunionunion"><span class="octicon octicon-link"></span></a>com.gensler.scalavro.util.Union.union</h4>

<div class="highlight highlight-scala"><pre><span class="k">import</span> <span class="nn">com.gensler.scalavro.types.AvroType</span>
<span class="k">import</span> <span class="nn">com.gensler.scalavro.util.Union._</span>

<span class="nc">AvroType</span><span class="o">[</span><span class="kt">union</span> <span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">#</span><span class="kt">or</span> <span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">#</span><span class="kt">or</span> <span class="o">[</span><span class="kt">Boolean</span><span class="o">]].</span><span class="n">schema</span>
</pre></div>

<p>Which yields:</p>

<div class="highlight highlight-json"><pre><span class="p">[</span><span class="s2">"int"</span><span class="p">,</span> <span class="s2">"string"</span><span class="p">,</span> <span class="s2">"boolean"</span><span class="p">]</span>
</pre></div>

<p><a name="fixed"></a></p>

<h3>
<a name="fixed-length-data" class="anchor" href="#fixed-length-data"><span class="octicon octicon-link"></span></a>Fixed-Length Data</h3>

<div class="highlight highlight-scala"><pre><span class="k">package</span> <span class="nn">com.gensler.scalavro.tests</span>

<span class="k">import</span> <span class="nn">com.gensler.scalavro.types.AvroType</span>
<span class="k">import</span> <span class="nn">com.gensler.scalavro.util.FixedData</span>
<span class="k">import</span> <span class="nn">scala.collection.immutable</span>

<span class="nd">@FixedData</span><span class="o">.</span><span class="nc">Length</span><span class="o">(</span><span class="mi">16</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">MD5</span><span class="o">(</span><span class="k">override</span> <span class="k">val</span> <span class="n">bytes</span><span class="k">:</span> <span class="kt">immutable.Seq</span><span class="o">[</span><span class="kt">Byte</span><span class="o">])</span>
           <span class="k">extends</span> <span class="nc">FixedData</span><span class="o">(</span><span class="n">bytes</span><span class="o">)</span>

<span class="nc">AvroType</span><span class="o">[</span><span class="kt">MD5</span><span class="o">].</span><span class="n">schema</span>
</pre></div>

<p>Which yields:</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"MD5"</span><span class="p">,</span>
  <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"fixed"</span><span class="p">,</span>
  <span class="nt">"size"</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
  <span class="nt">"namespace"</span><span class="p">:</span> <span class="s2">"com.gensler.scalavro.tests"</span>
<span class="p">}</span>
</pre></div>

<p><a name="records"></a></p>

<h3>
<a name="records" class="anchor" href="#records"><span class="octicon octicon-link"></span></a>Records</h3>

<h4>
<a name="from-case-classes" class="anchor" href="#from-case-classes"><span class="octicon octicon-link"></span></a>From case classes</h4>

<div class="highlight highlight-scala"><pre><span class="k">package</span> <span class="nn">com.gensler.scalavro.tests</span>
<span class="k">import</span> <span class="nn">com.gensler.scalavro.types.AvroType</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>

<span class="k">val</span> <span class="n">personAvroType</span> <span class="k">=</span> <span class="nc">AvroType</span><span class="o">[</span><span class="kt">Person</span><span class="o">]</span>
<span class="n">personAvroType</span><span class="o">.</span><span class="n">schema</span>
</pre></div>

<p>Which yields:</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"Person"</span><span class="p">,</span>
  <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"record"</span><span class="p">,</span>
  <span class="nt">"fields"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="nt">"name"</span><span class="p">:</span> <span class="s2">"name"</span><span class="p">,</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">},</span>
    <span class="p">{</span><span class="nt">"name"</span><span class="p">:</span> <span class="s2">"age"</span><span class="p">,</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"int"</span><span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">"namespace"</span><span class="p">:</span> <span class="s2">"com.gensler.scalavro.tests"</span>
<span class="p">}</span>
</pre></div>

<p>And perhaps more interestingly:</p>

<div class="highlight highlight-scala"><pre><span class="k">case</span> <span class="k">class</span> <span class="nc">SantaList</span><span class="o">(</span><span class="n">nice</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">Person</span><span class="o">],</span> <span class="n">naughty</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">Person</span><span class="o">])</span>

<span class="k">val</span> <span class="n">santaListAvroType</span> <span class="k">=</span> <span class="nc">AvroType</span><span class="o">[</span><span class="kt">SantaList</span><span class="o">]</span>
<span class="n">santaListAvroType</span><span class="o">.</span><span class="n">schema</span>
</pre></div>

<p>Which yields:</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
  <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"SantaList"</span><span class="p">,</span>
  <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"record"</span><span class="p">,</span>
  <span class="nt">"fields"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"nice"</span><span class="p">,</span>
      <span class="nt">"type"</span><span class="p">:</span> <span class="p">{</span><span class="nt">"type"</span><span class="p">:</span> <span class="s2">"array"</span><span class="p">,</span> <span class="nt">"items"</span><span class="p">:</span> <span class="s2">"Person"</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"naughty"</span><span class="p">,</span>
      <span class="nt">"type"</span><span class="p">:</span> <span class="p">{</span><span class="nt">"type"</span><span class="p">:</span> <span class="s2">"array"</span><span class="p">,</span> <span class="nt">"items"</span><span class="p">:</span> <span class="s2">"Person"</span><span class="p">}</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">"namespace"</span><span class="p">:</span> <span class="s2">"com.gensler.scalavro.tests"</span>
<span class="p">}</span>
</pre></div>

<p><a name="supertypes-of-case-classes"></a></p>

<h4>
<a name="from-supertypes-of-case-classes" class="anchor" href="#from-supertypes-of-case-classes"><span class="octicon octicon-link"></span></a>From supertypes of case classes</h4>

<p>Given:</p>

<div class="highlight highlight-scala"><pre><span class="k">class</span> <span class="nc">Alpha</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Beta</span> <span class="k">extends</span> <span class="nc">Alpha</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Gamma</span><span class="o">()</span> <span class="k">extends</span> <span class="nc">Alpha</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Delta</span><span class="o">()</span> <span class="k">extends</span> <span class="nc">Beta</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Epsilon</span><span class="o">[</span><span class="kt">T</span><span class="o">]()</span> <span class="k">extends</span> <span class="nc">Beta</span>
</pre></div>

<p>Usage:</p>

<div class="highlight highlight-scala"><pre><span class="k">import</span> <span class="nn">com.gensler.scalavro.AvroType</span>
<span class="nc">AvroType</span><span class="o">[</span><span class="kt">Alpha</span><span class="o">].</span><span class="n">schema</span>
</pre></div>

<p>Which yields:</p>

<div class="highlight highlight-json"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">"name"</span> <span class="p">:</span> <span class="s2">"Delta"</span><span class="p">,</span>
    <span class="nt">"type"</span> <span class="p">:</span> <span class="s2">"record"</span><span class="p">,</span>
    <span class="nt">"fields"</span> <span class="p">:</span> <span class="p">[],</span>
    <span class="nt">"namespace"</span> <span class="p">:</span> <span class="s2">"com.gensler.scalavro.tests"</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">"name"</span> <span class="p">:</span> <span class="s2">"Gamma"</span><span class="p">,</span>
    <span class="nt">"type"</span> <span class="p">:</span> <span class="s2">"record"</span><span class="p">,</span>
    <span class="nt">"fields"</span> <span class="p">:</span> <span class="p">[],</span>
    <span class="nt">"namespace"</span> <span class="p">:</span> <span class="s2">"com.gensler.scalavro.tests"</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>

<p>Note that in the above example:</p>

<ul>
<li>
<code>Alpha</code> is excluded from the union because it is not a case class</li>
<li>
<code>Beta</code> is excluded from the union because it is abstract and not a case class</li>
<li>
<code>Epsilon</code> is excluded from the union because it takes type parameters</li>
</ul><p><a name="binary-io"></a></p>

<h2>
<a name="scalavro-by-example-binary-io" class="anchor" href="#scalavro-by-example-binary-io"><span class="octicon octicon-link"></span></a>Scalavro by Example: Binary IO</h2>

<div class="highlight highlight-scala"><pre><span class="k">import</span> <span class="nn">com.gensler.scalavro.AvroType</span>
<span class="k">import</span> <span class="nn">com.gensler.scalavro.io.AvroTypeIO</span>
<span class="k">import</span> <span class="nn">scala.util.</span><span class="o">{</span><span class="nc">Try</span><span class="o">,</span> <span class="nc">Success</span><span class="o">,</span> <span class="nc">Failure</span><span class="o">}</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">SantaList</span><span class="o">(</span><span class="n">nice</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">Person</span><span class="o">],</span> <span class="n">naughty</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">Person</span><span class="o">])</span>

<span class="k">val</span> <span class="n">santaList</span> <span class="k">=</span> <span class="nc">SantaList</span><span class="o">(</span>
  <span class="n">nice</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
    <span class="nc">Person</span><span class="o">(</span><span class="s">"John"</span><span class="o">,</span> <span class="mi">17</span><span class="o">),</span>
    <span class="nc">Person</span><span class="o">(</span><span class="s">"Eve"</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
  <span class="o">),</span>
  <span class="n">naughty</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
    <span class="nc">Person</span><span class="o">(</span><span class="s">"Jane"</span><span class="o">,</span> <span class="mi">25</span><span class="o">),</span>
    <span class="nc">Person</span><span class="o">(</span><span class="s">"Alice"</span><span class="o">,</span> <span class="mi">65</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">)</span>

<span class="k">val</span> <span class="n">santaListType</span> <span class="k">=</span> <span class="nc">AvroType</span><span class="o">[</span><span class="kt">SantaList</span><span class="o">]</span>

<span class="k">val</span> <span class="n">outStream</span><span class="k">:</span> <span class="kt">java.io.OutputStream</span> <span class="o">=</span> <span class="c1">// some stream...</span>

<span class="n">santaListType</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="o">(</span><span class="n">santaList</span><span class="o">,</span> <span class="n">outStream</span><span class="o">)</span>

<span class="k">val</span> <span class="n">inStream</span><span class="k">:</span> <span class="kt">java.io.InputStream</span> <span class="o">=</span> <span class="c1">// some stream...</span>

<span class="n">santaListType</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="o">(</span><span class="n">inStream</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">readResult</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="c1">// readResult is an instance of SantaList</span>
  <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">cause</span><span class="o">)</span>      <span class="k">=&gt;</span> <span class="c1">// handle failure...</span>
<span class="o">}</span>
</pre></div>

<h3>
<a name="a-neat-fact-about-scalavros-io-capabilities" class="anchor" href="#a-neat-fact-about-scalavros-io-capabilities"><span class="octicon octicon-link"></span></a>A Neat Fact about Scalavro's IO Capabilities</h3>

<p>Scalavro tries to produce read results whose runtime types are as accurate as possible for colections (the supported collection types are <code>Seq</code>, <code>Set</code>, and <code>Map</code>).  It accomplishes this by looking for a public varargs <code>apply</code> factory method on the target type's companion object.  This is why <code>AvroType[ArrayBuffer[Int]].io.read(…)</code> is able to return a <code>Try[ArrayBuffer[Int]]</code>.</p>

<p>This works for custom subtypes of the supported collections types -- as long as you define a public varargs <code>apply</code> in the companion you're good to go.</p>

<h2>
<a name="reference" class="anchor" href="#reference"><span class="octicon octicon-link"></span></a>Reference</h2>

<ol>
<li><a href="http://avro.apache.org/docs/current/spec.html">Current Apache Avro Specification</a></li>
<li><a href="http://docs.scala-lang.org/overviews/reflection/overview.html">Scala 2.10 Reflection Overview</a></li>
<li><a href="http://martin.kleppmann.com/2012/12/05/schema-evolution-in-avro-protocol-buffers-thrift.html">Great article on schema evolution in various serialization systems</a></li>
<li><a href="http://chuusai.com/2011/06/09/scala-union-types-curry-howard">Wickedly clever technique for representing unboxed union types, proposed by Miles Sabin</a></li>
</ol><h2>
<a name="legal" class="anchor" href="#legal"><span class="octicon octicon-link"></span></a>Legal</h2>

<p>Apache Avro is a trademark of The Apache Software Foundation.</p>

<p>Scalavro is distributed under the BSD 2-Clause License, the text of which follows:</p>

<p>Copyright (c) 2013, Gensler<br>
All rights reserved.</p>

<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>

<ul>
<li><p>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</p></li>
<li><p>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</p></li>
</ul><p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>